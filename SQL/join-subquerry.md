# <div align='center'> –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã </div>

## üß≠ –û–ø–∏—Å–∞–Ω–∏–µ

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Å–æ–±—Ä–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ –≤–ª–∞–¥–µ–Ω–∏–µ **—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Ç–∞–±–ª–∏—Ü (JOIN)** –∏ **–≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏ (subqueries)**. –≠—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –∞ —Ç–∞–∫–∂–µ –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

–ù–∞–≤—ã–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö —Ä–∞–∑–¥–µ–ª–∞:

- –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è `INNER JOIN`, `LEFT JOIN`, `USING` –∏ `ON`.
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã –≤ `SELECT`, `FROM` –∏ `WHERE`.
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `WITH` (CTE) –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –Ω–∞ —à–∞–≥–∏.
- –†–∞—Å—á—ë—Ç—ã –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∏–º.
- –†–∞–±–æ—Ç–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü.

## –ó–∞–ø—Ä–æ—Å—ã

### 1. –¢–æ–ø-10 —Å–∞–º—ã—Ö –ø–æ–∫—É–ø–∞–µ–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

#### –£—Å–ª–æ–≤–∏–µ:
–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ 10 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`. –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–∞ –≤ –∑–∞–∫–∞–∑–∞—Ö (—É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä—ã –≤ –∑–∞–∫–∞–∑–∞—Ö). –£—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ **–Ω–µ–æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ** –∑–∞–∫–∞–∑—ã. –í—ã–≤–µ—Å—Ç–∏ `product_id`, `times_purchased`. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ‚Äî –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é `product_id`.

```sql
WITH tw AS (
    SELECT unnest(product_ids) AS product_id
    FROM orders
    WHERE order_id NOT IN (
        SELECT order_id
        FROM user_actions
        WHERE action LIKE '%cancel%'
    )
)
SELECT product_id, times_purchased
FROM (
    SELECT product_id,
           COUNT(product_id) AS times_purchased
    FROM tw
    GROUP BY product_id
    ORDER BY COUNT(product_id) DESC
    LIMIT 10
) AS t2
ORDER BY 1;
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| product_id | times_purchased |
|------------|------------------|
| 1          | 3915             |
| 20         | 3887             |
| 25         | 3604             |
| 34         | 3873             |
| 40         | 3932             |
| 65         | 3905             |
| 70         | 3549             |
| 74         | 3782             |
| 76         | 3889             |
| 77         | 3930             |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 10 </i> </p>

---

### 2. –°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞

#### –£—Å–ª–æ–≤–∏–µ:
–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—É–º–º–∞—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞. –í—ã–≤–µ—Å—Ç–∏ `order_id` –∏ `order_price`. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ‚Äî –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é `order_id`. –í—ã–≤–µ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ **1000 —Å—Ç—Ä–æ–∫** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

```sql
SELECT order_id,
       SUM(price) AS order_price
FROM (
    SELECT od.order_id AS order_id,
           pr.product_id AS product_id,
           pr.price AS price
    FROM (
        SELECT order_id,
               unnest(product_ids) AS product_id
        FROM orders
        ORDER BY 1
    ) AS od
    LEFT JOIN products AS pr USING (product_id)
) AS t1
GROUP BY 1
ORDER BY 1
LIMIT 1000;
```
#### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| order_id | order_price |
|----------|--------------|
| 1        | 175.0        |
| 2        | 394.0        |
| 3        | 493.0        |
| 4        | 156.0        |
| ...      | ...          |
| 996      | 295.0        |
| 997      | 150.0        |
| 998      | 358.0        |
| 999      | 289.0        |
| 1000     | 69.0         |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 1000 </i> </p>
