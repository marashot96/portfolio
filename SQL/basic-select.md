<div align="center"> 
       <a href="https://github.com/marashot96/portfolio/blob/main/SQL/Navigation.md">üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞–≤—ã–∫–∞–º –≤ SQL </a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       <a href="https://github.com/marashot96/portfolio"> üá¨üáß English version </a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       <a href="https://github.com/marashot96/portfolio/blob/main/README.md#-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-–ø—Ä–æ–µ–∫—Ç—ã">üîô –ù–∞–∑–∞–¥ –∫ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ </a>  
</div> 

# <div align='center'> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞  </div>

## üß≠ –û–ø–∏—Å–∞–Ω–∏–µ

<p align='justify'> –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Å–æ–±—Ä–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ SQL: –∞–≥—Ä–µ–≥–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –æ–∫–æ–Ω–Ω—ã–µ –∏ —É—Å–ª–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏, –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ —Ç–∏–ø–∞–º–∏ `timestamp`. –≠—Ç–∏ –∑–∞–¥–∞—á–∏ —Ä–µ—à–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã: –æ—Ç —Ä–∞—Å—á—ë—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –¥–æ –æ—Ü–µ–Ω–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–∫–∞–∑–æ–≤ –∏ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ü–µ–Ω–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏. </p>

–ù–∞–≤—ã–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö —Ä–∞–∑–¥–µ–ª–∞:

- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ —É—Å–ª–æ–≤–∏—è–º (`GROUP BY`, `FILTER`, `CASE`).
- –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º (`date_part`, `to_char`, `timestamp`).
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤ (`array_length`).
- –°–ª–æ–∂–Ω—ã–µ `CASE`-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞.
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –¥–µ–π—Å—Ç–≤–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## üîç –ó–∞–ø—Ä–æ—Å—ã

### 1. –î–æ–ª—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (–≤ —Ä–∞–∑—Ä–µ–∑–µ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏)

#### –£—Å–ª–æ–≤–∏–µ:
–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å–ª–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö, –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, –∞ —Ç–∞–∫–∂–µ **–¥–æ–ª—é –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤** (—É—Å–ø–µ—à–Ω—ã—Ö) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å 24 –∞–≤–≥—É—Å—Ç–∞ –ø–æ 6 —Å–µ–Ω—Ç—è–±—Ä—è 2022 –≥–æ–¥–∞. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ‚Äî –ø–æ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –ø–æ—Ä—è–¥–∫–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É –¥–Ω—è –Ω–µ–¥–µ–ª–∏.

#### –ó–∞–ø—Ä–æ—Å:
```sql
SELECT 
    date_part('isodow', time)::integer AS weekday_number,
    to_char(time, 'Dy') AS weekday,
    COUNT(order_id) FILTER (WHERE action LIKE 'cr%') AS created_orders,
    COUNT(order_id) FILTER (WHERE action LIKE 'cancel%') AS canceled_orders,
    COUNT(order_id) FILTER (WHERE action LIKE 'cr%') - COUNT(order_id) FILTER (WHERE action LIKE 'cancel%') AS actual_orders,
    ROUND(
        (COUNT(order_id) FILTER (WHERE action LIKE 'cr%') - COUNT(order_id) FILTER (WHERE action LIKE 'cancel%')) 
        / COUNT(order_id) FILTER (WHERE action LIKE 'cr%')::DECIMAL, 
        3
    ) AS success_rate
FROM user_actions
WHERE time BETWEEN '2022-08-24' AND '2022-09-07'
GROUP BY 1, 2
ORDER BY 1;
```
#### –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ 1:

| weekday_number | weekday | created_orders | canceled_orders | actual_orders | success_rate |
|----------------|---------|----------------|-----------------|---------------|--------------|
| 1              | Mon     | 8374           | 434             | 7940          | 0.948        |
| 2              | Tue     | 7193           | 370             | 6823          | 0.949        |
| 3              | Wed     | 3758           | 210             | 3548          | 0.944        |
| 4              | Thu     | 5004           | 258             | 4746          | 0.948        |
| 5              | Fri     | 6800           | 352             | 6448          | 0.948        |
| 6              | Sat     | 8249           | 399             | 7850          | 0.952        |
| 7              | Sun     | 9454           | 443             | 9011          | 0.953        |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 7 </i> </p> 

---

### 2. –û—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ä–µ–¥–∞–º –≤ –∞–≤–≥—É—Å—Ç–µ

#### –£—Å–ª–æ–≤–∏–µ:
–í—ã–±—Ä–∞—Ç—å –≤—Å–µ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤, —Å–æ–≤–µ—Ä—à—ë–Ω–Ω—ã–µ **–ø–æ —Å—Ä–µ–¥–∞–º** –≤ –∞–≤–≥—É—Å—Ç–µ 2022 –≥–æ–¥–∞ —Å **12:00 –¥–æ 15:59**. –í—ã–≤–µ—Å—Ç–∏ user_id, order_id, —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è –∏ –¥–∞—Ç—É. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ‚Äî –ø–æ —É–±—ã–≤–∞–Ω–∏—é ID –∑–∞–∫–∞–∑–∞.

#### –ó–∞–ø—Ä–æ—Å:
```sql
SELECT 
    user_id,
    order_id,
    action,
    time
FROM user_actions
WHERE 
    action = 'cancel_order'
    AND date_part('year', time) = 2022
    AND date_part('month', time) = 8
    AND date_part('dow', time) = 3
    AND date_part('hour', time) BETWEEN 12 AND 15
ORDER BY order_id DESC;
```
#### –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ 2 (—Ñ—Ä–∞–≥–º–µ–Ω—Ç):

| user_id | order_id | action       | time           |
|---------|----------|--------------|----------------|
| 8117    | 17307    | cancel_order | 31/08/22 15:59 |
| 8107    | 17282    | cancel_order | 31/08/22 15:50 |
| 1495    | 17272    | cancel_order | 31/08/22 15:46 |
| ...        | ...             | ...       | ... |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 36 </i> </p>

---

### 3. –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∑–∞–∫–∞–∑–∞: –±—É–¥–Ω–∏ vs. –≤—ã—Ö–æ–¥–Ω—ã–µ

#### –£—Å–ª–æ–≤–∏–µ:
–ü–æ—Å—á–∏—Ç–∞—Ç—å **—Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ** –ø–æ –±—É–¥–Ω—è–º –∏ –≤—ã—Ö–æ–¥–Ω—ã–º. –ë—É–¥–Ω–∏ ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫‚Äì–ø—è—Ç–Ω–∏—Ü–∞, –≤—ã—Ö–æ–¥–Ω—ã–µ ‚Äî —Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ. –í—ã–≤–µ—Å—Ç–∏ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏: `week_part`, `avg_order_size`. –û–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ‚Äî –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞.

#### –ó–∞–ø—Ä–æ—Å:
```sql
SELECT 
    CASE 
        WHEN date_part('dow', creation_time) BETWEEN 1 AND 5 THEN 'weekdays'
        ELSE 'weekend'
    END AS week_part,
    ROUND(AVG(array_length(product_ids, 1)), 2) AS avg_order_size
FROM orders
GROUP BY 1
ORDER BY avg_order_size;
```
#### –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ 3:

| week_part | avg_order_size |
|-----------|----------------|
| weekend   | 3.39           |
| weekdays  | 3.40           |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 2 </i> </p>

---

### 4. –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω: —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º

#### –£—Å–ª–æ–≤–∏–µ:
–ü–æ–≤—ã—Å–∏—Ç—å —Ü–µ–Ω—É **–Ω–∞ 5%**, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- —Ü–µ–Ω–∞ > 100 ‚ÇΩ,
- —Ü–µ–Ω–∞ < 800 ‚ÇΩ,
- –∏ —ç—Ç–æ –Ω–µ –∏–∫—Ä–∞ (—É–∫–∞–∑–∞–Ω–æ –∫–æ—Å–≤–µ–Ω–Ω–æ: –∏–∫—Ä–∞ —Å—Ç–æ–∏—Ç —Ä–æ–≤–Ω–æ 800 ‚ÇΩ).

–í—ã–≤–µ—Å—Ç–∏ `product_id`, `name`, `old_price`, `new_price`. –ë–µ–∑ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é –Ω–æ–≤–æ–π —Ü–µ–Ω—ã, –∑–∞—Ç–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é ID.

#### –ó–∞–ø—Ä–æ—Å:
```sql
SELECT 
    product_id,
    name,
    price AS old_price,
    CASE 
        WHEN price > 100 AND price < 800 THEN 1.05 * price
        ELSE price
    END AS new_price
FROM products
ORDER BY new_price DESC, product_id;
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ 4 (—Ñ—Ä–∞–≥–º–µ–Ω—Ç):

| product_id | name            | old_price | new_price |
|------------|-----------------|-----------|-----------|
| 13         | –∏–∫—Ä–∞            | 800.0     | 800.0     |
| 37         | –±–∞—Ä–∞–Ω–∏–Ω–∞        | 559.0     | 586.95    |
| 15         | –º–∞—Å–ª–æ –æ–ª–∏–≤–∫–æ–≤–æ–µ | 450.0     | 472.5     |
| ...        | ...             | ...       | ...       |
| 73         | –ª–µ–ø–µ—à–∫–∞         | 15.0      | 15.0      |
| 10         | —Å–µ–º–µ—á–∫–∏         | 12.0      | 12.0      |
| 54         | –ø–∞–∫–µ—Ç –±—É–º–∞–∂–Ω—ã–π  | 1.0       | 1.0       |

<p> <i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: 87 </i> </p>

---

## üíº –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Å—É–¥–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç—ã, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–µ–π—Å –∏–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ!

- üì´ [t.me/marashot96](https://t.me/marashot96)
- üåê [marashot96@ya.ru](mailto:marashot96@ya.ru)


<div align="center"> 
       <a href="https://github.com/marashot96/portfolio/blob/main/SQL/Navigation.md">üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞–≤—ã–∫–∞–º –≤ SQL </a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       <a href="https://github.com/marashot96/portfolio/blob/main/README.md#-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-–ø—Ä–æ–µ–∫—Ç—ã">üîô –ù–∞–∑–∞–¥ –∫ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ </a>  
</div> 
