# 	Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ, ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°, Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° 

## ðŸ§­ ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ
ÐÐ°Ð²Ñ‹ÐºÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ… Ñ€Ð°Ð·Ð´ÐµÐ»Ð°:

- Ð“Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¸ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼ (`GROUP BY`, `FILTER`, `CASE`).
- Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð´Ð°Ñ‚Ð°Ð¼Ð¸ Ð¸ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼ (`date_part`, `to_char`, `timestamp`).
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð² Ð¸ Ð¸Ñ… ÑÐ²Ð¾Ð¹ÑÑ‚Ð² (`array_length`).
- Ð¡Ð»Ð¾Ð¶Ð½Ñ‹Ðµ `CASE`-ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¸ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°.
- Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ¾Ð¹.
- ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ðº ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ðµ Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.

---

## ðŸ” Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹

### 1. ðŸ“Š Ð”Ð¾Ð»Ñ Ð´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð² (Ð² Ñ€Ð°Ð·Ñ€ÐµÐ·Ðµ Ð´Ð½ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸)

#### Ð£ÑÐ»Ð¾Ð²Ð¸Ðµ:
Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð¾Ñ‚Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ñ… Ð¸ Ð´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð², Ð° Ñ‚Ð°ÐºÐ¶Ðµ **Ð´Ð¾Ð»ÑŽ Ð´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð²** (ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ…) Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ Ñ 24 Ð°Ð²Ð³ÑƒÑÑ‚Ð° Ð¿Ð¾ 6 ÑÐµÐ½Ñ‚ÑÐ±Ñ€Ñ 2022 Ð³Ð¾Ð´Ð°. Ð“Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° â€” Ð¿Ð¾ ÑÐ¾ÐºÑ€Ð°Ñ‰Ñ‘Ð½Ð½Ð¾Ð¼Ñƒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð¸ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð²Ð¾Ð¼Ñƒ Ð½Ð¾Ð¼ÐµÑ€Ñƒ Ð´Ð½Ñ Ð½ÐµÐ´ÐµÐ»Ð¸.

```sql
SELECT 
    date_part('isodow', time)::integer AS weekday_number,
    to_char(time, 'Dy') AS weekday,
    COUNT(order_id) FILTER (WHERE action LIKE 'cr%') AS created_orders,
    COUNT(order_id) FILTER (WHERE action LIKE 'cancel%') AS canceled_orders,
    COUNT(order_id) FILTER (WHERE action LIKE 'cr%') - COUNT(order_id) FILTER (WHERE action LIKE 'cancel%') AS actual_orders,
    ROUND(
        (COUNT(order_id) FILTER (WHERE action LIKE 'cr%') - COUNT(order_id) FILTER (WHERE action LIKE 'cancel%')) 
        / COUNT(order_id) FILTER (WHERE action LIKE 'cr%')::DECIMAL, 
        3
    ) AS success_rate
FROM user_actions
WHERE time BETWEEN '2022-08-24' AND '2022-09-07'
GROUP BY 1, 2
ORDER BY 1;
```
#### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° 1:

| weekday_number | weekday | created_orders | canceled_orders | actual_orders | success_rate |
|----------------|---------|----------------|-----------------|---------------|--------------|
| 1              | Mon     | 8374           | 434             | 7940          | 0.948        |
| 2              | Tue     | 7193           | 370             | 6823          | 0.949        |
| 3              | Wed     | 3758           | 210             | 3548          | 0.944        |
| 4              | Thu     | 5004           | 258             | 4746          | 0.948        |
| 5              | Fri     | 6800           | 352             | 6448          | 0.948        |
| 6              | Sat     | 8249           | 399             | 7850          | 0.952        |
| 7              | Sun     | 9454           | 443             | 9011          | 0.953        |

ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‚Ñ€Ð¾Ðº: 7
---

### 2. âŒ ÐžÑ‚Ð¼ÐµÐ½Ñ‹ Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð¿Ð¾ ÑÑ€ÐµÐ´Ð°Ð¼ Ð² Ð°Ð²Ð³ÑƒÑÑ‚Ðµ

#### Ð£ÑÐ»Ð¾Ð²Ð¸Ðµ:
Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð·Ð°ÐºÐ°Ð·Ð¾Ð², ÑÐ¾Ð²ÐµÑ€ÑˆÑ‘Ð½Ð½Ñ‹Ðµ **Ð¿Ð¾ ÑÑ€ÐµÐ´Ð°Ð¼** Ð² Ð°Ð²Ð³ÑƒÑÑ‚Ðµ 2022 Ð³Ð¾Ð´Ð° Ñ **12:00 Ð´Ð¾ 15:59**. Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ user_id, order_id, Ñ‚Ð¸Ð¿ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¸ Ð´Ð°Ñ‚Ñƒ. Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° â€” Ð¿Ð¾ ÑƒÐ±Ñ‹Ð²Ð°Ð½Ð¸ÑŽ ID Ð·Ð°ÐºÐ°Ð·Ð°.

```sql
SELECT 
    user_id,
    order_id,
    action,
    time
FROM user_actions
WHERE 
    action = 'cancel_order'
    AND date_part('year', time) = 2022
    AND date_part('month', time) = 8
    AND date_part('dow', time) = 3
    AND date_part('hour', time) BETWEEN 12 AND 15
ORDER BY order_id DESC;
```
#### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° 2 (Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚):

| user_id | order_id | action       | time           |
|---------|----------|--------------|----------------|
| 8117    | 17307    | cancel_order | 31/08/22 15:59 |
| 8107    | 17282    | cancel_order | 31/08/22 15:50 |
| 1495    | 17272    | cancel_order | 31/08/22 15:46 |
| ...        | ...             | ...       | 

ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‚Ñ€Ð¾Ðº: 36
---

### 3. ðŸ“¦ Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°: Ð±ÑƒÐ´Ð½Ð¸ vs. Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ

#### Ð£ÑÐ»Ð¾Ð²Ð¸Ðµ:
ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ **ÑÑ€ÐµÐ´Ð½ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð² Ð·Ð°ÐºÐ°Ð·Ðµ** Ð¿Ð¾ Ð±ÑƒÐ´Ð½ÑÐ¼ Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ð¼. Ð‘ÑƒÐ´Ð½Ð¸ â€” Ð¿Ð¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðºâ€“Ð¿ÑÑ‚Ð½Ð¸Ñ†Ð°, Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ â€” ÑÑƒÐ±Ð±Ð¾Ñ‚Ð° Ð¸ Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ. Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð´Ð²Ðµ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸: `week_part`, `avg_order_size`. ÐžÐºÑ€ÑƒÐ³Ð»Ð¸Ñ‚ÑŒ Ð´Ð¾ Ð´Ð²ÑƒÑ… Ð·Ð½Ð°ÐºÐ¾Ð². Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° â€” Ð¿Ð¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð°Ð½Ð¸ÑŽ ÑÑ€ÐµÐ´Ð½ÐµÐ³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ð·Ð°ÐºÐ°Ð·Ð°.

```sql
SELECT 
    CASE 
        WHEN date_part('dow', creation_time) BETWEEN 1 AND 5 THEN 'weekdays'
        ELSE 'weekend'
    END AS week_part,
    ROUND(AVG(array_length(product_ids, 1)), 2) AS avg_order_size
FROM orders
GROUP BY 1
ORDER BY avg_order_size;
```
#### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° 3:

| week_part | avg_order_size |
|-----------|----------------|
| weekend   | 3.39           |
| weekdays  | 3.40           |

ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‚Ñ€Ð¾Ðº: 2
---

### 4. ðŸ’° ÐŸÐ¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ðµ Ñ†ÐµÐ½: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½ÑƒÐ¶Ð½Ñ‹Ð¼ Ñ‚Ð¾Ð²Ð°Ñ€Ð°Ð¼

#### Ð£ÑÐ»Ð¾Ð²Ð¸Ðµ:
ÐŸÐ¾Ð²Ñ‹ÑÐ¸Ñ‚ÑŒ Ñ†ÐµÐ½Ñƒ **Ð½Ð° 5%**, Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸:
- Ñ†ÐµÐ½Ð° > 100 â‚½,
- Ñ†ÐµÐ½Ð° < 800 â‚½,
- Ð¸ ÑÑ‚Ð¾ Ð½Ðµ Ð¸ÐºÑ€Ð° (ÑƒÐºÐ°Ð·Ð°Ð½Ð¾ ÐºÐ¾ÑÐ²ÐµÐ½Ð½Ð¾: Ð¸ÐºÑ€Ð° ÑÑ‚Ð¾Ð¸Ñ‚ Ñ€Ð¾Ð²Ð½Ð¾ 800 â‚½).

Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ `product_id`, `name`, `old_price`, `new_price`. Ð‘ÐµÐ· Ð¾ÐºÑ€ÑƒÐ³Ð»ÐµÐ½Ð¸Ñ. Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°: Ð¿Ð¾ ÑƒÐ±Ñ‹Ð²Ð°Ð½Ð¸ÑŽ Ð½Ð¾Ð²Ð¾Ð¹ Ñ†ÐµÐ½Ñ‹, Ð·Ð°Ñ‚ÐµÐ¼ Ð¿Ð¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð°Ð½Ð¸ÑŽ ID.

```sql
SELECT 
    product_id,
    name,
    price AS old_price,
    CASE 
        WHEN price > 100 AND price < 800 THEN 1.05 * price
        ELSE price
    END AS new_price
FROM products
ORDER BY new_price DESC, product_id;

#### Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° 4 (Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚)

| product_id | name            | old_price | new_price |
|------------|-----------------|-----------|-----------|
| 13         | Ð¸ÐºÑ€Ð°            | 800.0     | 800.0     |
| 37         | Ð±Ð°Ñ€Ð°Ð½Ð¸Ð½Ð°        | 559.0     | 586.95    |
| 15         | Ð¼Ð°ÑÐ»Ð¾ Ð¾Ð»Ð¸Ð²ÐºÐ¾Ð²Ð¾Ðµ | 450.0     | 472.5     |
| ...        | ...             | ...       | ...       |
| 73         | Ð»ÐµÐ¿ÐµÑˆÐºÐ°         | 15.0      | 15.0      |
| 10         | ÑÐµÐ¼ÐµÑ‡ÐºÐ¸         | 12.0      | 12.0      |
| 54         | Ð¿Ð°ÐºÐµÑ‚ Ð±ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ð¹  | 1.0       | 1.0       |

ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‚Ñ€Ð¾Ðº: 87
